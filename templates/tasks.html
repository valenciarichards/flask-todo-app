{# tasks.html #}

{%  extends "base.html" %}
{% block content %}


<h1>My Tasks</h1>
<<a href="{{ url_for('logout') }}">Logout</a>

{# Add task #}

<div class="add-task">
  <h3>Add a new task:</h3>
  <form action="{{ url_for('add_task') }}" method="POST" class="form-inline">
    {# Add CSRF protection #}
    {{ form.csrf_token }}
    <div class="form-group">
      {{ form.name.label }}
      {{ form.name (class="form-control") }}
    </div>
    <div class="form-group">
      {{ form.due_date.label }}
      {{ form.due_date (class="form-control") }}
    </div>
    <div class="form-group">
      {{ form.priority.label }}
      {{ form.priority (class="form-control") }}
    </div>
    <div class="form-group">
      <button type="submit" class="btn btn-default">Submit</button>
    </div>
  </form>
</div>

<br>
<br>

{# Dropdown Menu for sorting tasks #}

<div class="dropdown">
  <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    Sort tasks by
     <span class="caret"></span>
  </button>
  <ul class="dropdown-menu form-group" aria-labelledby="dropdownMenuButton">
    <li><a class="dropdown-item form-control" href="{{ url_for('tasks') }}">Date Created: Oldest First (default)</a></li>
    <li><a class="dropdown-item form-control" href="{{ url_for('tasks', sort_param='by_newest_first') }}">Date Created: Newest First</a></li>
    <li><a class="dropdown-item form-control" href="{{ url_for('tasks', sort_param='by_earliest_due_date') }}">Earliest Due Date</a></li>
    <li><a class="dropdown-item form-control" href="{{ url_for('tasks', sort_param='by_highest_priority') }}">Highest Priority</a></li>
  </ul>
</div>


{# Show incomplete tasks #}

<div class="entries">
  <br>
  <br>
  <h2>Incomplete tasks:</h2>
    <div class="datagrid">
    <table class="table">
      <thead>
        <tr>
          <th scope="col">Task Name</th>
          <th scope="col">Date Created</th>
          <th scope="col">Due Date</th>
          <th scope="col">Priority</th>
          <th scope="col">Actions</th>
        </tr>
      </thead>
        <tbody>
          {% for task in incomplete_tasks %}
            <tr>
              <td>{{ task.name }}</td>
              <td>{{ task.created_datetime.strftime("%m/%d/%Y, %-I:%M %p") }}</td>
              <td>{{ task.due_date.strftime("%m/%d/%Y") }}</td>
              <td>{{ task.priority }}</td>
              <td>
                <a href="{{ url_for('mark_task_as_complete', task_id=task.id) }}">Mark as Complete</a>
                <a href="{{ url_for('edit_task', task_id=task.id) }}">Edit</a>
                <a href="{{ url_for('delete_task', task_id=task.id) }}">Delete</a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
    </table>
    </div>
</div>
<br>

{# Show complete tasks #}

<br>
<div class="entries">
  <h2>Complete tasks:</h2>
  <div class="datagrid">
    <table class="table">
      <thead>
        <tr>
          <th scope="col">Task Name</th>
          <th scope="col">Date Created</th>
          <th scope="col">Due Date</th>
          <th scope="col">Priority</th>
          <th scope="col">Actions</th>
        </tr>
      </thead>
        <tbody>
          {% for task in complete_tasks %}
            <tr>
              <td>{{ task.name }}</td>
              <td>{{ task.created_datetime.strftime("%m/%d/%Y, %-I:%M %p") }}</td>
              <td>{{ task.due_date.strftime("%m/%d/%Y") }}</td>
              <td>{{ task.priority }}</td>
              <td>
                 <a href="{{ url_for('delete_task', task_id=task.id) }}">Delete</a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
    </table>
  </div>
</div>

{% endblock %}